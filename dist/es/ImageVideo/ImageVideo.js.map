{"version":3,"file":"ImageVideo.js","sources":["../../../src/ImageVideo/ImageVideo.js"],"sourcesContent":["import React, { forwardRef, useEffect, useRef, useState } from 'react'\nimport { Box } from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport { tracking } from '../_common/tracking'\nimport MobileFirstVideo from '../MobileFirstVideo/MobileFirstVideo'\n\nconst ImageVideo = forwardRef(\n  (\n    {\n      videoId,\n      playBtnRef,\n      trackingLabel = 'unlabeled',\n      poster,\n      quality,\n      dcCodePlay,\n      dcCodeComplete,\n      image,\n      ...props\n    },\n    ref\n  ) => {\n    const playPercent = useRef(0)\n    const trackedPercent = useRef(null)\n\n    const playButtonLabelEl = useRef()\n    const videoRef = useRef()\n    const [hasPlayed, setHasPlayed] = useState(false)\n    const [hasEnded, setHasEnded] = useState(false)\n\n    useEffect(() => {\n      const videoEl = videoRef.current\n\n      const trackPercent = () => {\n        if (\n          trackedPercent.current !== playPercent.current &&\n          playPercent.current !== 0\n        ) {\n          trackedPercent.current = playPercent.current\n          tracking.track('Video Percent Played', {\n            category: 'Video Interactions',\n            action: 'Played Percent',\n            label: trackingLabel,\n            value: playPercent.current,\n          })\n          playPercent.current = 0\n          trackedPercent.current = null\n        }\n      }\n\n      const handleVideoUpdate = (e) => {\n        const { currentTime, duration } = e.target\n        const currentPercent = millisecsToPercent(duration, currentTime)\n        if (currentPercent > playPercent.current) {\n          playPercent.current = currentPercent\n        }\n      }\n\n      const handleVideoEnd = () => {\n        if (!hasEnded) {\n          tracking.track('Video Completed', {\n            category: 'Video Interactions',\n            action: 'Video Ended',\n            label: trackingLabel,\n            dcCode: dcCodeComplete,\n          })\n\n          setHasEnded(true)\n        }\n\n        const isFullscreen = isFullScreen()\n        if (isFullscreen) {\n          if (document.exitFullscreen) {\n            document.exitFullscreen()\n          }\n          if (document.webkitExitFullscreen) {\n            document.webkitExitFullscreen()\n          }\n          if (document.mozExitFullscreen) {\n            document.mozExitFullscreen()\n          }\n          if (document.msExitFullscreen) {\n            document.msExitFullscreen()\n          }\n        }\n      }\n\n      const handleWindowUnload = (e) => {\n        trackPercent()\n      }\n\n      const handleFullScreenChange = () => {\n        const isFullscreen = isFullScreen()\n        if (!isFullscreen) {\n          trackPercent()\n          videoRef.current.currentTime = 0\n          videoRef.current.pause(true)\n        }\n      }\n\n      if (videoEl) {\n        ;['', 'webkit', 'moz', 'ms'].forEach((prefix) =>\n          document.addEventListener(\n            prefix + 'fullscreenchange',\n            handleFullScreenChange\n          )\n        )\n        videoEl.addEventListener('webkitendfullscreen', handleFullScreenChange)\n        videoEl.addEventListener('timeupdate', handleVideoUpdate)\n        videoEl.addEventListener('ended', handleVideoEnd)\n        window.addEventListener('beforeunload', handleWindowUnload)\n      }\n\n      const resetVideo = () => {\n        if (videoEl) {\n          ;['', 'webkit', 'moz', 'ms'].forEach((prefix) =>\n            document.removeEventListener(\n              prefix + 'fullscreenchange',\n              handleFullScreenChange\n            )\n          )\n          videoEl.removeEventListener(\n            'webkitendfullscreen',\n            handleFullScreenChange\n          )\n          videoEl.removeEventListener('timeupdate', handleVideoUpdate)\n          videoEl.removeEventListener('ended', handleVideoEnd)\n          window.removeEventListener('beforeunload', handleWindowUnload)\n        }\n      }\n\n      return () => {\n        resetVideo()\n      }\n    }, [hasEnded, trackingLabel, dcCodeComplete])\n\n    const isFullScreen = () => {\n      return (\n        document.fullscreenElement ||\n        document.mozFullScreenElement ||\n        document.webkitFullscreenElement\n      )\n    }\n\n    const handlePlayClick = () => {\n      const videoEl = videoRef.current\n      requestFullScreen(videoEl)\n      videoEl.play()\n\n      if (!hasPlayed) {\n        tracking.track('Video Started', {\n          category: 'Video Interactions',\n          action: 'Video Play',\n          label: trackingLabel,\n          dcCode: dcCodePlay,\n        })\n\n        setHasPlayed(true)\n      }\n    }\n\n    const requestFullScreen = (videoEl) => {\n      if (videoEl.requestFullscreen) {\n        videoEl.requestFullscreen()\n        return\n      }\n\n      if (videoEl.webkitSupportsFullscreen) {\n        videoEl.webkitEnterFullScreen()\n        return\n      }\n\n      if (videoEl.mozRequestFullScreen) {\n        videoEl.mozRequestFullScreen()\n        return\n      }\n\n      if (videoEl.msRequestFullScreen) {\n        videoEl.msRequestFullScreen()\n        return\n      }\n    }\n\n    return (\n      <VideoContainer ref={ref} {...props}>\n        <DisplayContainer>\n          <PlayButton onClick={handlePlayClick} ref={playBtnRef}>\n            <span ref={playButtonLabelEl}>Play</span>\n          </PlayButton>\n          <ImageContainer>\n            <ImageContainerInner>{image}</ImageContainerInner>\n          </ImageContainer>\n        </DisplayContainer>\n        <PlayerContainer>\n          <MobileFirstVideo\n            ref={videoRef}\n            publicId={videoId}\n            preload=\"none\"\n            controlsList=\"nodownload\"\n            disablePictureInPicture\n            quality={quality}\n          />\n        </PlayerContainer>\n      </VideoContainer>\n    )\n  }\n)\n\nImageVideo.propTypes = {\n  trackingLabel: PropTypes.string,\n  videoId: PropTypes.string.isRequired,\n}\n\nconst VideoContainer = styled(Box)`\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n  width: 100%;\n`\n\nconst DisplayContainer = styled.div`\n  position: relative;\n  z-index: 2;\n`\n\nconst PlayerContainer = styled.div`\n  z-index: 1;\n  position: absolute;\n  height: 1px;\n  width: 1px;\n  top: 50%;\n  left: 50%;\n  overflow: hidden;\n`\n\nconst ImageContainer = styled.div`\n  border-radius: 50%;\n  overflow: hidden;\n  /* Note: Safari does not respect scale(1.05), so took the recoomendation to use scale3d https://stackoverflow.com/questions/27825098/image-shifting-jumping-after-css-transition-effect-with-scale-transform-in-firef */\n  transform: scale3d(1, 1, 1);\n`\n\nconst ImageContainerInner = styled.div`\n  transition: transform 0.3s ease-out;\n  /* Note: Safari does not respect scale(1.05), so took the recoomendation to use scale3d https://stackoverflow.com/questions/27825098/image-shifting-jumping-after-css-transition-effect-with-scale-transform-in-firef */\n  transform: scale3d(1, 1, 1);\n`\n\nconst PlayButton = styled.button`\n  border: none;\n  background: none;\n  position: absolute;\n  border-radius: 50%;\n  z-index: 2;\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n  color: #ffffff;\n\n  &:hover,\n  &:focus {\n    span {\n      background: ${({ theme }) => theme.palette.primary.main};\n    }\n    & + ${ImageContainer} ${ImageContainerInner} {\n      /* Note: Safari does not respect scale(1.05), so took the recoomendation to use scale3d https://stackoverflow.com/questions/27825098/image-shifting-jumping-after-css-transition-effect-with-scale-transform-in-firef */\n      transform: scale3d(1.05, 1.05, 1);\n    }\n  }\n\n  span {\n    display: block;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    margin: 0;\n    padding: 0;\n    width: 80px;\n    height: 80px;\n    line-height: 80px;\n    text-align: center;\n    border-radius: 50%;\n    background-color: rgba(0, 0, 0, 0.5);\n    transition: background 0.3s ease-out;\n    color: #ffffff;\n    font-size: 16px;\n    cursor: pointer;\n  }\n`\n\nconst millisecsToPercent = (duration, time) =>\n  Math.floor((time / duration) * 100)\n\nexport default ImageVideo\n"],"names":["ImageVideo","forwardRef","ref","videoId","playBtnRef","trackingLabel","poster","quality","dcCodePlay","dcCodeComplete","image","props","playPercent","useRef","trackedPercent","playButtonLabelEl","videoRef","useState","hasPlayed","setHasPlayed","hasEnded","setHasEnded","useEffect","videoEl","current","trackPercent","tracking","track","category","action","label","value","handleVideoUpdate","e","target","currentTime","duration","currentPercent","millisecsToPercent","handleVideoEnd","dcCode","isFullscreen","isFullScreen","document","exitFullscreen","webkitExitFullscreen","mozExitFullscreen","msExitFullscreen","handleWindowUnload","handleFullScreenChange","pause","forEach","prefix","addEventListener","window","resetVideo","removeEventListener","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","handlePlayClick","requestFullScreen","play","requestFullscreen","webkitSupportsFullscreen","webkitEnterFullScreen","mozRequestFullScreen","msRequestFullScreen","propTypes","PropTypes","string","isRequired","VideoContainer","styled","Box","DisplayContainer","div","PlayerContainer","ImageContainer","ImageContainerInner","PlayButton","button","theme","palette","primary","main","time","Math","floor"],"mappings":"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"}